<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palmeiras Corridas Running Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.7.0/chart.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.7.0/chart.min.js"></script>
</head>
<body>
    <header>
        <h1>Palmeiras Corridas Running Tracker</h1>
    </header>
    <main>
        <form id="runForm">
            <input type="date" id="runDate" required>
            <input type="number" id="runDistance" placeholder="Distance (km)" required>
            <input type="number" id="runTime" placeholder="Time (min)" required>
            <button type="submit">Register Run</button>
        </form>
        <button id="exportPDF">Export as PDF</button>
        <button id="exportCSV">Export as CSV</button>
        <div id="chartContainer">
            <canvas id="distanceChart"></canvas>
            <canvas id="speedChart"></canvas>
        </div>
        <table id="runTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Distance (km)</th>
                    <th>Time (min)</th>
                    <th>Speed (km/h)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <footer>
            <p>Footer Content Here</p>
        </footer>
    </main>
    <script>
        const runForm = document.getElementById('runForm');
        const runTable = document.getElementById('runTable').getElementsByTagName('tbody')[0];
        const distanceChartCtx = document.getElementById('distanceChart').getContext('2d');
        const speedChartCtx = document.getElementById('speedChart').getContext('2d');
        let runs = JSON.parse(localStorage.getItem('runs')) || [];
        const distanceChart = new Chart(distanceChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Distance (km)',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false
                }]
            }
        });
        const speedChart = new Chart(speedChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Speed (km/h)',
                    data: [],
                    borderColor: 'rgba(255, 99, 132, 1)',
                    fill: false
                }]
            }
        });
        runForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const date = new Date(runForm.runDate.value);
            const distance = parseFloat(runForm.runDistance.value);
            const time = parseFloat(runForm.runTime.value);
            const speed = (distance / (time / 60)).toFixed(2);
            const runEntry = { date, distance, time, speed };
            runs.push(runEntry);
            localStorage.setItem('runs', JSON.stringify(runs));
            updateRunTable();
            updateCharts();
        });
        function updateRunTable() {
            runTable.innerHTML = '';
            runs.forEach((run, index) => {
                const row = runTable.insertRow();
                row.insertCell(0).innerText = run.date.toISOString().substring(0, 10);
                row.insertCell(1).innerText = run.distance;
                row.insertCell(2).innerText = run.time;
                row.insertCell(3).innerText = run.speed;
                const actionsCell = row.insertCell(4);
                actionsCell.innerHTML = `<button onclick="deleteRun(${index})">Delete</button>`;
            });
        }
        function deleteRun(index) {
            runs.splice(index, 1);
            localStorage.setItem('runs', JSON.stringify(runs));
            updateRunTable();
            updateCharts();
        }
        function updateCharts() {
            distanceChart.data.labels = runs.map(run => run.date.toISOString().substring(0, 10));
            distanceChart.data.datasets[0].data = runs.map(run => run.distance);
            distanceChart.update();
            speedChart.data.labels = runs.map(run => run.date.toISOString().substring(0, 10));
            speedChart.data.datasets[0].data = runs.map(run => run.speed);
            speedChart.update();
        }
        document.getElementById('exportPDF').addEventListener('click', function() {
            const element = document.getElementById('runTable');
            html2pdf().from(element).save('runs.pdf');
        });
        document.getElementById('exportCSV').addEventListener('click', function() {
            const csvRows = []; 
            csvRows.push(['Date', 'Distance (km)', 'Time (min)', 'Speed (km/h)']);
            runs.forEach(run => {
                csvRows.push([run.date.toISOString().substring(0, 10), run.distance, run.time, run.speed]);
            });
            const csvString = csvRows.map(e => e.join(',')).join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', 'runs.csv');
            a.click();
        });
        updateRunTable();
        updateCharts();
    </script>
</body>
</html>